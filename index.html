// Créer un effet ondulant sur le lac
function createLakeRipples() {
    const points = document.querySelectorAll('.point');
    
    // Créer des ondulations aléatoires sur le lac
    function createRipple() {
        // Choisir un point aléatoire parmi les points existants
        const randomPoint = points[Math.floor(Math.random() * points.length)];
        const rect = randomPoint.getBoundingClientRect();
        
        const ripple = document.createElement('div');
        ripple.className = 'ripple';
        ripple.style.left = `${rect.left + rect.width/2 - 100}px`; // Centrer l'onde
        ripple.style.top = `${rect.top + rect.height/2 - 100}px`;
        document.body.appendChild(ripple);
        
        // Supprimer l'élément après l'animation
        setTimeout(() => {
            ripple.remove();
        }, 1500);
    }
    
    // Créer une ondulation immédiatement
    createRipple();
    
    // Puis régulièrement
    setInterval(createRipple, 5000);
}

// Afficher des infos au survol des points sur le palier 3
document.querySelectorAll('.point').forEach((point, index) => {
    // Ajouter un label visible pour chaque point
    const label = document.createElement('div');
    label.className = 'point-label';
    label.textContent = point.getAttribute('data-info');
    point.appendChild(label);
    
    // Événements de survol
    point.addEventListener('mouseover', function(e) {
        const tooltip = document.getElementById('tooltip');
        const description = translations[currentLang]?.descriptions[index] || 
                          translations['fr'].descriptions[index]; // Fallback au français
        
        tooltip.textContent = description;
        tooltip.style.top = (e.clientY - 40) + 'px';
        tooltip.style.left = (e.clientX + 15) + 'px';
        tooltip.style.opacity = '1';
        
        // Effet d'onde sur survol
        const rect = this.getBoundingClientRect();
        const ripple = document.createElement('div');
        ripple.className = 'ripple';
        ripple.style.left = `${rect.left + rect.width/2 - 100}px`;
        ripple.style.top = `${rect.top + rect.height/2 - 100}px`;
        document.body.appendChild(ripple);
        
        // Supprimer l'onde après l'animation
        setTimeout(() => {
            ripple.remove();
        }, 1500);
    });
    
    point.addEventListener('mouseout', function() {
        document.getElementById('tooltip').style.opacity = '0';
    });
    
    point.addEventListener('click', function() {
        alert(`Navigation vers: ${this.getAttribute('data-info')}`);
    });
    
    // Accessibilité au clavier
    point.addEventListener('focus', function(e) {
        const tooltip = document.getElementById('tooltip');
        const description = translations[currentLang]?.descriptions[index] || 
                          translations['fr'].descriptions[index];
        
        const rect = this.getBoundingClientRect();
        
        tooltip.textContent = description;
        tooltip.style.top = (rect.top - 40) + 'px';
        tooltip.style.left = (rect.left + rect.width/2) + 'px';
        tooltip.style.opacity = '1';
    });
    
    point.addEventListener('blur', function() {
        document.getElementById('tooltip').style.opacity = '0';
    });
});

// Gestion des contrôles clavier pour l'accessibilité
document.addEventListener('keydown', function(e) {
    // Navigation dans les boutons de langue (Palier 1)
    if (document.getElementById('palier1').style.opacity !== '0') {
        const langButtons = document.querySelectorAll('.lang-btn');
        const focused = document.activeElement;
        
        if (e.key === 'ArrowDown') {
            e.preventDefault();
            // Trouver l'index du bouton actuellement focalisé
            let index = Array.from(langButtons).indexOf(focused);
            
            // Si aucun bouton n'est focalisé ou c'est le dernier, focus sur le premier
            if (index === -1 || index === langButtons.length - 1) {
                langButtons[0].focus();
            } else {
                langButtons[index + 1].focus();
            }
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            let index = Array.from(langButtons).indexOf(focused);
            
            if (index === -1 || index === 0) {
                langButtons[langButtons.length - 1].focus();
            } else {
                langButtons[index - 1].focus();
            }
        } else if (e.key === 'Enter' && focused.classList.contains('lang-btn')) {
            focused.click();
        }
    }
    
    // Activation du grimoire (Palier 2)
    if (document.getElementById('palier2').style.opacity === '1') {
        if (e.key === 'Enter') {
            document.getElementById('grimoire-btn').click();
        }
    }
    
    // Navigation entre les points (Palier 3)
    if (document.getElementById('palier3').style.opacity === '1') {
        const points = document.querySelectorAll('.point');
        const focused = document.activeElement;
        
        if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
            e.preventDefault();
            let index = Array.from(points).indexOf(focused);
            
            if (index === -1 || index === points.length - 1) {
                points[0].focus();
            } else {
                points[index + 1].focus();
            }
        } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
            e.preventDefault();
            let index = Array.from(points).indexOf(focused);
            
            if (index === -1 || index === 0) {
                points[points.length - 1].focus();
            } else {
                points[index - 1].focus();
            }
        } else if (e.key === 'Enter' && focused.classList.contains('point')) {
            focused.click();
        }
    }
});

// Initialiser le titre de bienvenue
window.addEventListener('load', function() {
    updateWelcomeTitle('fr');
});

// Démarrer le préchargement des images au chargement de la page
window.addEventListener('load', preloadImages);
